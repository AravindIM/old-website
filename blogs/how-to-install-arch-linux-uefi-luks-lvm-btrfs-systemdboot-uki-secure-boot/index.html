<!DOCTYPE html>
<html>

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta http-equiv="Accept-CH" content="DPR, Viewport-Width, Width">
<link rel="icon" href=https://gravatar.com/avatar/1a4f24684715f73e2ae948f646a8db75?s&#61;32 type="image/gif">


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload"
      as="style"
      href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
>
<link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      media="print" onload="this.media='all'" />
<noscript>
  <link
          href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
          rel="stylesheet">
</noscript>


<link rel="stylesheet" href="/css/font.css" media="all">



<meta property="og:title" content="How to install Arch Linux with UEFI &#43; LUKS &#43; LVM &#43;  BTRFS &#43; Unified Kernel Image &#43; System D Boot &#43; Secure Boot" />
<meta property="og:description" content="Installation Steps 1. Connect to Wifi Source: iwctl
# iwctl [iwd]# device list [iwd]# device deviceName set-property Powered on [iwd]# station deviceName scan [iwd]# station deviceName get-networks [iwd]# station deviceName connect SSID # exit (i) Check internet $ ping archlinux.org 2. Check system time $ timedatectl 3. Partition disks (i) Check disk # fdisk -l (ii) Create partitions disk Enter fdisk # fdisk /dev/sdX Create GPT label Command (m for help): g Created a new GPT disklabel (GUID: ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://aravindim.github.io/blogs/how-to-install-arch-linux-uefi-luks-lvm-btrfs-systemdboot-uki-secure-boot/" /><meta property="article:section" content="blogs" />
<meta property="article:published_time" content="2023-08-11T19:09:11+05:30" />
<meta property="article:modified_time" content="2023-08-11T19:09:11+05:30" /><meta property="og:site_name" content="Aravind I M" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to install Arch Linux with UEFI &#43; LUKS &#43; LVM &#43;  BTRFS &#43; Unified Kernel Image &#43; System D Boot &#43; Secure Boot"/>
<meta name="twitter:description" content="Installation Steps 1. Connect to Wifi Source: iwctl
# iwctl [iwd]# device list [iwd]# device deviceName set-property Powered on [iwd]# station deviceName scan [iwd]# station deviceName get-networks [iwd]# station deviceName connect SSID # exit (i) Check internet $ ping archlinux.org 2. Check system time $ timedatectl 3. Partition disks (i) Check disk # fdisk -l (ii) Create partitions disk Enter fdisk # fdisk /dev/sdX Create GPT label Command (m for help): g Created a new GPT disklabel (GUID: ."/>


<link rel="stylesheet" href="/bootstrap-5/css/bootstrap.min.css" media="all"><link rel="stylesheet" href="/css/header.css" media="all">
<link rel="stylesheet" href="/css/footer.css" media="all">


<link rel="stylesheet" href="/css/theme.css" media="all">




<style>
    :root {
        --text-color: #343a40;
        --text-secondary-color: #6c757d;
        --background-color: #eaedf0;
        --secondary-background-color: #64ffda1a;
        --primary-color: #007bff;
        --secondary-color: #f8f9fa;

         
        --text-color-dark: #e4e6eb;
        --text-secondary-color-dark: #b0b3b8;
        --background-color-dark: #18191a;
        --secondary-background-color-dark: #212529;
        --primary-color-dark: #ffffff;
        --secondary-color-dark: #212529;
    }
    body {
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        text-align: left;
    }

    html {
        background-color: var(--background-color) !important;
    }

    body::-webkit-scrollbar {
        width: .5em;
        height: .5em;
        background-color: var(--background-color);
    }
    
    ::-webkit-scrollbar-track {
        box-shadow: inset 0 0 6px var(--background-color);
        border-radius: 1rem;
    }
    
    ::-webkit-scrollbar-thumb {
        border-radius: 1rem;
        background-color: var(--secondary-color);
        outline: 1px solid var(--background-color);
    }

    #search-content::-webkit-scrollbar {
        width: .5em;
        height: .1em;
        background-color: var(--background-color);
    }
</style>

<meta name="description" content="">
<link rel="stylesheet" href="/css/single.css">


<script defer src="/fontawesome-5/all-5.15.4.js"></script>

  <title>
How to install Arch Linux with UEFI &#43; LUKS &#43; LVM &#43;  BTRFS &#43; Unified Kernel Image &#43; System D Boot &#43; Secure Boot | Aravind I M

  </title>
</head>

<body class="light">
  
  
<script>
    let localStorageValue = localStorage.getItem("pref-theme");
    let mediaQuery = window.matchMedia('(prefers-color-scheme: dark)').matches;

    switch (localStorageValue) {
        case "dark":
            document.body.classList.add('dark');
            break;
        case "light":
            document.body.classList.remove('dark');
            break;
        default:
            if (mediaQuery) {
                document.body.classList.add('dark');
            }
            break;
    }
</script>



<header>
    <nav class="pt-3 navbar navbar-expand-lg animate">
        <div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5">
            
            <a class="navbar-brand primary-font text-wrap" href="/">
                
                <img src="https://gravatar.com/avatar/1a4f24684715f73e2ae948f646a8db75?s=32" width="30" height="30"
                    class="d-inline-block align-top">
                Aravind I M
                
            </a>

            
                <div>
                    <input id="search" autocomplete="off" class="form-control mr-sm-2 d-none d-md-block" placeholder='Ctrl &#43; k to Search...'
                        aria-label="Search" oninput="searchOnChange(event)">
                </div>
            

            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <svg aria-hidden="true" height="24" viewBox="0 0 16 16" version="1.1" width="24" data-view-component="true">
                    <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z"></path>
                </svg>
            </button>

            
            <div class="collapse navbar-collapse text-wrap primary-font" id="navbarContent">
                <ul class="navbar-nav ms-auto text-center">
                    
                        <li class="nav-item navbar-text d-block d-md-none">
                            <div class="nav-link">
                                <input id="search" autocomplete="off" class="form-control mr-sm-2" placeholder='Ctrl &#43; k to Search...' aria-label="Search" oninput="searchOnChange(event)">
                            </div>
                        </li>
                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#about" aria-label="about">
                            About Me
                        </a>
                    </li>
                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#experience"
                            aria-label="experience">
                            Experience
                        </a>
                    </li>
                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#education"
                            aria-label="education">
                            Education
                        </a>
                    </li>
                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#projects"
                            aria-label="projects">
                            Projects
                        </a>
                    </li>
                    

                    

                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#contact"
                            aria-label="contact">
                            Contact
                        </a>
                    </li>
                    

                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/blogs" title="Blog posts">
                            
                            Blog
                        </a>
                    </li>
                    
                    

                    
                    <li class="nav-item navbar-text">
                        
                        <div class="text-center">
                            <button id="theme-toggle">
                                <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                                </svg>
                                <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="5"></circle>
                                    <line x1="12" y1="1" x2="12" y2="3"></line>
                                    <line x1="12" y1="21" x2="12" y2="23"></line>
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                    <line x1="1" y1="12" x2="3" y2="12"></line>
                                    <line x1="21" y1="12" x2="23" y2="12"></line>
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                </svg>
                            </button>
                        </div>
                    </li>
                    

                </ul>

            </div>
        </div>
    </nav>
</header>
<div id="content">
<section id="single">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-sm-12 col-md-12 col-lg-9">
        <div class="pr-lg-4">
          <div class="title mb-5">
            <h1 class="text-center mb-4">How to install Arch Linux with UEFI &#43; LUKS &#43; LVM &#43;  BTRFS &#43; Unified Kernel Image &#43; System D Boot &#43; Secure Boot</h1>
            <div class="text-center">
              Aravind I M 
              <small>|</small>
              Aug 11, 2023

              
              <span id="readingTime">
                min read
              </span>
              
            </div>
          </div>
          
          <div class="featured-image">
            <img class="img-fluid" src="/images/post.jpg" alt="How to install Arch Linux with UEFI &#43; LUKS &#43; LVM &#43;  BTRFS &#43; Unified Kernel Image &#43; System D Boot &#43; Secure Boot">
          </div>
          
          <article class="page-content  p-2">
          <h1 id="installation-steps">Installation Steps</h1>
<h2 id="1-connect-to-wifi">1. Connect to Wifi</h2>
<p>Source: <a href="https://wiki.archlinux.org/title/Iwd#iwctl">iwctl</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># iwctl</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>iwd<span style="color:#f92672">]</span><span style="color:#75715e"># device list</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>iwd<span style="color:#f92672">]</span><span style="color:#75715e"># device deviceName set-property Powered on</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>iwd<span style="color:#f92672">]</span><span style="color:#75715e"># station deviceName scan</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>iwd<span style="color:#f92672">]</span><span style="color:#75715e"># station deviceName get-networks</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>iwd<span style="color:#f92672">]</span><span style="color:#75715e"># station deviceName connect SSID</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># exit</span>
</span></span></code></pre></div><h3 id="i-check-internet">(i) Check internet</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ping archlinux.org
</span></span></code></pre></div><h2 id="2-check-system-time">2. Check system time</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ timedatectl
</span></span></code></pre></div><h2 id="3-partition-disks">3. Partition disks</h2>
<h3 id="i-check-disk">(i) Check disk</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># fdisk -l</span>
</span></span></code></pre></div><h3 id="ii-create-partitions-disk">(ii) Create partitions disk</h3>
<ol>
<li>Enter fdisk</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># fdisk /dev/sdX</span>
</span></span></code></pre></div><ol start="2">
<li>Create GPT label</li>
</ol>
<pre tabindex="0"><code>Command (m for help): g
Created a new GPT disklabel (GUID: ...).
</code></pre><ol start="2">
<li>Create boot partition</li>
</ol>
<pre tabindex="0"><code>Command (m for help): n
Partition number: 
First sector: 
Last sector, +/-sectors or +/-size{K,M,G,T,P}: +512M

Command (m for help): t
Partition type or alias (type L to list all): uefi
</code></pre><ol start="3">
<li>Make remaining partition for LUKS</li>
</ol>
<pre tabindex="0"><code>Command (m for help): n
Partition number: 
First sector: 
Last sector, +/-sectors or +/-size{K,M,G,T,P}: 
</code></pre><ol start="4">
<li>Print partition info to verify</li>
</ol>
<pre tabindex="0"><code>Command (m for help): p
</code></pre><ol start="5">
<li>Write changes (write changes and quit)</li>
</ol>
<pre tabindex="0"><code>Command (m for help): w
</code></pre><ol start="6">
<li>Quit fdisk (quit without writing changes in case of mistakes)</li>
</ol>
<pre tabindex="0"><code>Command (m for help): q
</code></pre><h3 id="iii-format-boot-disk">(iii) Format Boot disk</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># mkfs.fat -F 32 -n EFI /dev/sdXY</span>
</span></span></code></pre></div><h2 id="3-setup-luks">3. Setup LUKS</h2>
<h3 id="i-create-luks-partition">(i) Create LUKS partition</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># cryptsetup --use-random luksFormat /dev/sdXZ</span>
</span></span><span style="display:flex;"><span>Are you sure? YES
</span></span><span style="display:flex;"><span>Enter passphrase:
</span></span><span style="display:flex;"><span>Verify passphrase:
</span></span></code></pre></div><h3 id="ii-open-luks-partition">(ii) Open LUKS partition</h3>
<p>You can use any other name instead of cryptroot but be sure to replace it everywhere in the following commands</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># cryptsetup open /dev/sdXZ cryptroot</span>
</span></span></code></pre></div><h4 id="note">Note</h4>
<p>Once you created LVM, you only need to open the disk with cryptsetup
No additional command needed to access volume group (vg) all the existing LVM partitions are accessible right after unlocking the luks partition.
This might come in handy if you wish to had to reboot the system after LVM setup</p>
<h2 id="4-setup-lvm">4. Setup LVM</h2>
<h3 id="i-create-lvm-group">(i) Create LVM group</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># pvcreate /dev/mapper/cryptroot</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># vgcreate vgroot /dev/mapper/cryptroot</span>
</span></span></code></pre></div><h3 id="ii-create-lvm-partitions">(ii) Create LVM Partitions</h3>
<p>This assumes you don&rsquo;t need separate home partition on LVM</p>
<p>Create swap</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># lvcreate --size 8G vgroot --name swap</span>
</span></span></code></pre></div><p>Create root</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># lvcreate -l +100%FREE vgroot --name root</span>
</span></span></code></pre></div><h3 id="iii-format-lvm-partitions">(iii) Format LVM partitions</h3>
<p>Format swap</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># mkswap /dev/vgroot/swap -L swap</span>
</span></span></code></pre></div><p>Format root</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># mkfs.btrfs /dev/vgroot/root -L root</span>
</span></span></code></pre></div><h2 id="5-create-btrfs-subvolumes">5. Create Btrfs Subvolumes</h2>
<p>Mount btrfs partition to /mnt (install target root)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># mount -t btrfs LABEL=root /mnt</span>
</span></span></code></pre></div><p>Create partitions one by one</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># btrfs subvolume create /mnt/@</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># btrfs subvolume create /mnt/@home</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># btrfs subvolume create /mnt/@tmp</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># btrfs subvolume create /mnt/@varlog</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># btrfs subvolume create /mnt/@snapshots</span>
</span></span></code></pre></div><p>Disable Copy-on-Write for tmp and varlog</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># chattr +C /mnt/@tmp</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># chattr +C /mnt/@varlog</span>
</span></span></code></pre></div><p>Unmount /mnt (install target root)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># umount -R /mnt</span>
</span></span></code></pre></div><h2 id="6-mount-partitions">6. Mount Partitions</h2>
<h3 id="i-btrfs-subvolumes">(i) Btrfs Subvolumes</h3>
<p>The followings options can be set for mounting</p>
<ul>
<li>commit = time interval between data-writes in seconds</li>
<li>x-mount.mkdir = make directory if not existing when mounting</li>
<li>ssd = ssd based btrfs optimisations</li>
<li>noatime = do not store access time for files (makes btrfs faster)</li>
<li>nodiratime = do not store directory access time for files (makes btrfs faster)</li>
<li>discard = set as async, asynchronous queued TRIM for discard freed file blocks, check below</li>
</ul>
<p>check if discard is supported by checking if the output is greater than 0:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># cat /sys/block/sdX/queue/discard_max_bytes</span>
</span></span></code></pre></div><p>Mount btrfs subvolumes one by one:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># mount -t btrfs -o defaults,x-mount.mkdir,compress=zstd,ssd,noatime,nodiratime,discard=async,space_cache=v2,commit=120,subvol=@ LABEL=root /mnt</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># mount -t btrfs -o defaults,x-mount.mkdir,compress=zstd,ssd,noatime,nodiratime,discard=async,space_cache=v2,commit=120,subvol=@home LABEL=root /mnt/home</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># mount -t btrfs -o defaults,x-mount.mkdir,compress=zstd,ssd,noatime,nodiratime,discard=async,space_cache=v2,commit=120,subvol=@tmp LABEL=root /mnt/tmp</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># mount -t btrfs -o defaults,x-mount.mkdir,compress=zstd,ssd,noatime,nodiratime,discard=async,space_cache=v2,commit=120,subvol=@varlog LABEL=root /mnt/var/log</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># mount -t btrfs -o defaults,x-mount.mkdir,compress=zstd,ssd,noatime,nodiratime,discard=async,space_cache=v2,commit=120,subvol=@snapshots LABEL=root /mnt/.snapshots</span>
</span></span></code></pre></div><h3 id="ii-mount-efi-dir">(ii) Mount EFI dir</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># mkdir -p /mnt/boot/efi</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># mount LABEL=EFI /mnt/boot/efi</span>
</span></span></code></pre></div><h2 id="7-setup-mirrorlist-using-reflector">7. Setup Mirrorlist using Reflector</h2>
<p>Install reflector:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># pacman -Syy reflector</span>
</span></span></code></pre></div><p>Configure mirrorlist using reflector:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># reflector --verbose --sort rate --save /etc/pacman.d/mirrorlist</span>
</span></span></code></pre></div><h2 id="8-pacstrap-base-packages">8. Pacstrap Base Packages</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># pacstrap -K /mnt base linux linux-firmware vim nano</span>
</span></span></code></pre></div><h2 id="9-generate-mount-info-fstab">9. Generate Mount Info Fstab</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># genfstab -L -p /mnt &gt;&gt; /mnt/etc/fstab</span>
</span></span></code></pre></div><h2 id="10-chroot-into-installed-environment">10. Chroot into Installed Environment</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># arch-chroot /mnt</span>
</span></span></code></pre></div><h2 id="11-set-timezone">11. Set Timezone</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># ln -sf /usr/share/zoneinfo/Region/City /etc/localtime</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># hwclock --systohc</span>
</span></span></code></pre></div><h2 id="12-set-locale">12. Set Locale</h2>
<p>Edit /etc/locale.gen and uncomment the required locales then run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># locale-gen</span>
</span></span></code></pre></div><p>Create /etc/locale.conf with content:</p>
<pre tabindex="0"><code>LANG=en_US.UTF-8
</code></pre><h2 id="13-configure-hostname">13. Configure Hostname</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># echo yourhostname &gt;&gt; /etc/hostname</span>
</span></span></code></pre></div><h2 id="14-install-additional-packages">14. Install additional packages</h2>
<p>Install required programs like shell, development packages, sudo, btfs, secure boot, ucode, bluetooth, wifi, desktop environment, etc:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># pacman -Syu base-devel btrfs-progs gptfdisk zsh sudo ttf-dejavu noto-fonts noto-fonts-cjk intel-ucode polkit wpa_supplicant mesa lvm2 efibootmgr bash-completion git man pipewire wireplumber pipewire-alsa pipewire-pulse gnome</span>
</span></span></code></pre></div><p>If installing gnome select pipewire-jack, wireplumber, noto-fonts-emoji in the proceeding interactive questions</p>
<h2 id="15-unified-kernel-image-setup">15. Unified Kernel Image Setup</h2>
<p>This step is useful for encrypted boot device. You can skip this step if you&rsquo;re using grub as grub comes with decrypting disk before the boot menu is shown. Most other bootloaders do not work with this setup.</p>
<h3 id="i-configure-mkinitcpio-hooks">(i) Configure mkinitcpio Hooks</h3>
<p>Edit /etc/mkinitcpio.conf and add systemd after base; sd-encrypt and lvm2 before filesystems:</p>
<pre tabindex="0"><code>HOOKS=(base systemd plymouth modconf keyboard keymap block lvm2 btrfs filesystems sd-encrypt fsck)
</code></pre><h3 id="ii-kernel-parameters">(ii) Kernel Parameters</h3>
<p>Create /etc/kernel/cmdline with contents:</p>
<pre tabindex="0"><code>fbcon=nodefer rw rd.luks.allow-discards quiet root=LABEL=root rootflags=subvol=@ rw splash vt.global_cursor_default=0
</code></pre><h3 id="iii-crypttab-setup">(iii) Crypttab setup</h3>
<p>Create file /etc/crypttab.initramfs with contents:</p>
<pre tabindex="0"><code>root /dev/mapper/cryptroot none timeout=180,tpm2-device=auto
</code></pre><h2 id="16-secure-boot-setup">16. Secure boot setup</h2>
<h3 id="i-install-secure-boot">(i) Install Secure Boot</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># pacman -Syyu sbctl</span>
</span></span></code></pre></div><h3 id="ii-create-secure-boot-keys">(ii) Create Secure boot keys</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># sbctl create-keys</span>
</span></span></code></pre></div><h3 id="iii-enroll-keys">(iii) Enroll keys</h3>
<p>Change attributes of keys in btrfs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># chattr -i /sys/firmware/efi/efivars/{PK,KEK,db}*</span>
</span></span></code></pre></div><p>In the above command, if either of PK,KEK or db causes command to fail remove that from the list and run with the rest.</p>
<p>Now, Enroll keys along with Microsoft keys (-m):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># sbctl enroll-keys -m</span>
</span></span></code></pre></div><p>Generate signed unified image:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># sbctl bundle -s /boot/efi/EFI/Linux/arch-linux.efi</span>
</span></span></code></pre></div><h3 id="iv-sign-bootloader-for-secureboot">(iv) Sign Bootloader for Secureboot</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># sbctl sign -s -o /usr/lib/systemd/boot/efi/systemd-bootx64.efi.signed /usr/lib/systemd/boot/efi/systemd-bootx64.efi</span>
</span></span></code></pre></div><h2 id="17-bootloader-systemd-boot">17. Bootloader: SystemD Boot</h2>
<p>Install Bootloader</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># bootctl install</span>
</span></span></code></pre></div><h2 id="18-user-management">18. User Management</h2>
<p>Create root password</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># passwd</span>
</span></span></code></pre></div><p>create user USERNAME:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># useradd -m -G wheel,storage,power -g users -s /bin/bash USERNAME</span>
</span></span></code></pre></div><p>create password for user USERNAME:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># passwd USERNAME</span>
</span></span></code></pre></div><p>Don&rsquo;t forget to uncomment wheel line with visudo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># visudo</span>
</span></span></code></pre></div><p>Search for the following line and remove the # infront of it:</p>
<pre tabindex="0"><code>%wheel ALL=(ALL:ALL) ALL
</code></pre><p>Switch user to USERNAME</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># sudo -u USERNAME -i</span>
</span></span></code></pre></div><h2 id="19-enable-services">19. Enable services</h2>
<p>Enable Gnome Display Manager:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># systemctl enable gdm</span>
</span></span></code></pre></div><p>Enable Network Manager:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># systemctl enable NetworkManager</span>
</span></span></code></pre></div><p>Enable Bluetooth:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># systemctl enable bluetooth</span>
</span></span></code></pre></div><h2 id="20-install-aur-helper">20. Install Aur helper</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># pacman -Syy go</span>
</span></span><span style="display:flex;"><span>$ git clone https://aur.archlinux.org/yay.git
</span></span><span style="display:flex;"><span>$ cd yay
</span></span><span style="display:flex;"><span>$ makepkg -is
</span></span><span style="display:flex;"><span>$ cd ..
</span></span><span style="display:flex;"><span>$ rm -rf yay
</span></span></code></pre></div><h2 id="21-plymouth-setup">21. Plymouth Setup</h2>
<h3 id="i-install-plymouth">(i) Install plymouth</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ yay -Syy plymouth-git
</span></span></code></pre></div><h3 id="ii-install-plymouth-theme">(ii) Install plymouth theme</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ yay -Syy plymouth-theme-bgrt-better-luks 
</span></span></code></pre></div><h3 id="iii-set-plymouth-theme">(iii) Set Plymouth theme</h3>
<p>Show installed plymouth themes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># plymouth-set-default-theme -l</span>
</span></span></code></pre></div><p>Set plymouth theme:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># plymouth-set-default-theme -R bgrt-better-luks</span>
</span></span></code></pre></div><h3 id="iv-rerun-mkinitcpio">(iv) Rerun mkinitcpio</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># mkinitcpio -p linux</span>
</span></span></code></pre></div><h3 id="v-regenerate-unified-kernel-image">(v) Regenerate Unified Kernel Image</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># sbctl generate-bundles -s</span>
</span></span></code></pre></div><h2 id="22-finish-install">22. Finish Install</h2>
<p>logout of user USERNAME, exit arch-chroot, unmount and reboot:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ exit
</span></span><span style="display:flex;"><span><span style="color:#75715e"># exit</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># umount -a</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># reboot</span>
</span></span></code></pre></div><p>Turn on secure boot in BIOS after this. Nothing else needed for Secure Boot.</p>
<h2 id="23-references">23. References</h2>
<ol>
<li><a href="https://wiki.archlinux.org/title/User:ZachHilman/Installation_-_Btrfs_%2B_LUKS2_%2B_Secure_Boot">https://wiki.archlinux.org/title/User:ZachHilman/Installation_-_Btrfs_%2B_LUKS2_%2B_Secure_Boot</a></li>
<li><a href="https://wiki.archlinux.org/title/Installation_guide">https://wiki.archlinux.org/title/Installation_guide</a></li>
<li><a href="https://gist.github.com/mjnaderi/28264ce68f87f52f2cabb823a503e673">https://gist.github.com/mjnaderi/28264ce68f87f52f2cabb823a503e673</a></li>
<li><a href="https://gist.github.com/martijnvermaat/76f2e24d0239470dd71050358b4d5134">https://gist.github.com/martijnvermaat/76f2e24d0239470dd71050358b4d5134</a></li>
<li><a href="https://nerdstuff.org/posts/2020/2020-004_arch_linux_luks_btrfs_systemd-boot/">https://nerdstuff.org/posts/2020/2020-004_arch_linux_luks_btrfs_systemd-boot/</a></li>
<li><a href="https://github.com/Szwendacz99/Arch-install-encrypted-btrfs">https://github.com/Szwendacz99/Arch-install-encrypted-btrfs</a></li>
<li><a href="https://www.reddit.com/r/archlinux/comments/127fp6g/plymouthencrypt_hook_no_longer_found_after_update/">https://www.reddit.com/r/archlinux/comments/127fp6g/plymouthencrypt_hook_no_longer_found_after_update/</a></li>
<li><a href="https://bbs.archlinux.org/viewtopic.php?id=284741">https://bbs.archlinux.org/viewtopic.php?id=284741</a></li>
<li><a href="https://www.youtube.com/watch?v=QQoZwP6-Y2k">https://www.youtube.com/watch?v=QQoZwP6-Y2k</a></li>
<li><a href="https://github.com/AravindIM/nixos-dotfiles/blob/main/hosts/thinkpad/hardware-configuration.nix">https://github.com/AravindIM/nixos-dotfiles/blob/main/hosts/thinkpad/hardware-configuration.nix</a></li>
<li><a href="https://github.com/AravindIM/arch-install/blob/main/install-gnome.sh">https://github.com/AravindIM/arch-install/blob/main/install-gnome.sh</a></li>
<li><a href="https://github.com/0xadeeb/dotFiles">https://github.com/0xadeeb/dotFiles</a></li>
<li><a href="https://github.com/0xadeeb/NixOs-config/blob/master/hosts/hp-pavilion/hardware-configuration.nix">https://github.com/0xadeeb/NixOs-config/blob/master/hosts/hp-pavilion/hardware-configuration.nix</a></li>
<li><a href="https://bbs.archlinux.org/viewtopic.php?id=243019">https://bbs.archlinux.org/viewtopic.php?id=243019</a></li>
<li><a href="https://wiki.archlinux.org/title/Talk:Mkinitcpio#Improvements_for_the_Common_hooks_table_and_section_about_systemd_hook">https://wiki.archlinux.org/title/Talk:Mkinitcpio#Improvements_for_the_Common_hooks_table_and_section_about_systemd_hook</a></li>
<li><a href="https://wiki.archlinux.org/title/Power_management/Suspend_and_hibernate">https://wiki.archlinux.org/title/Power_management/Suspend_and_hibernate</a></li>
<li><a href="https://askubuntu.com/questions/1304519/fstab-automatically-creates-mount-points">https://askubuntu.com/questions/1304519/fstab-automatically-creates-mount-points</a></li>
<li><a href="https://wiki.archlinux.org/title/User:Bai-Chiang/Installation_notes">https://wiki.archlinux.org/title/User:Bai-Chiang/Installation_notes</a></li>
<li><a href="https://wiki.archlinux.org/title/Unified_Extensible_Firmware_Interface/Secure_Boot">https://wiki.archlinux.org/title/Unified_Extensible_Firmware_Interface/Secure_Boot</a></li>
<li><a href="https://wiki.archlinux.org/title/Unified_kernel_image">https://wiki.archlinux.org/title/Unified_kernel_image</a></li>
<li><a href="https://wiki.archlinux.org/title/AUR_helpers">https://wiki.archlinux.org/title/AUR_helpers</a></li>
<li><a href="https://linuxhint.com/btrfs-filesystem-mount-options/">https://linuxhint.com/btrfs-filesystem-mount-options/</a></li>
<li><a href="https://linuxconfig.org/how-to-manage-efi-boot-manager-entries-on-linux">https://linuxconfig.org/how-to-manage-efi-boot-manager-entries-on-linux</a></li>
<li><a href="https://wiki.archlinux.org/title/dm-crypt/Encrypting_an_entire_system#Encrypted_boot_partition_(GRUB)">https://wiki.archlinux.org/title/dm-crypt/Encrypting_an_entire_system#Encrypted_boot_partition_(GRUB)</a></li>
<li><a href="https://git.launchpad.net/~ubuntu-core-dev/grub/+git/ubuntu/tree/debian/build-efi-images?h=debian/2.06-2ubuntu12">https://git.launchpad.net/~ubuntu-core-dev/grub/+git/ubuntu/tree/debian/build-efi-images?h=debian/2.06-2ubuntu12</a></li>
</ol>

          </article>
        </div>
      </div>
      <div class="col-sm-12 col-md-12 col-lg-3">
        <div class="sticky-sidebar">
          
          <aside class="toc">
              <h5>
                Table Of Contents
              </h5>
              <div class="toc-content">
                <nav id="TableOfContents">
  <ul>
    <li><a href="#1-connect-to-wifi">1. Connect to Wifi</a>
      <ul>
        <li><a href="#i-check-internet">(i) Check internet</a></li>
      </ul>
    </li>
    <li><a href="#2-check-system-time">2. Check system time</a></li>
    <li><a href="#3-partition-disks">3. Partition disks</a>
      <ul>
        <li><a href="#i-check-disk">(i) Check disk</a></li>
        <li><a href="#ii-create-partitions-disk">(ii) Create partitions disk</a></li>
        <li><a href="#iii-format-boot-disk">(iii) Format Boot disk</a></li>
      </ul>
    </li>
    <li><a href="#3-setup-luks">3. Setup LUKS</a>
      <ul>
        <li><a href="#i-create-luks-partition">(i) Create LUKS partition</a></li>
        <li><a href="#ii-open-luks-partition">(ii) Open LUKS partition</a></li>
      </ul>
    </li>
    <li><a href="#4-setup-lvm">4. Setup LVM</a>
      <ul>
        <li><a href="#i-create-lvm-group">(i) Create LVM group</a></li>
        <li><a href="#ii-create-lvm-partitions">(ii) Create LVM Partitions</a></li>
        <li><a href="#iii-format-lvm-partitions">(iii) Format LVM partitions</a></li>
      </ul>
    </li>
    <li><a href="#5-create-btrfs-subvolumes">5. Create Btrfs Subvolumes</a></li>
    <li><a href="#6-mount-partitions">6. Mount Partitions</a>
      <ul>
        <li><a href="#i-btrfs-subvolumes">(i) Btrfs Subvolumes</a></li>
        <li><a href="#ii-mount-efi-dir">(ii) Mount EFI dir</a></li>
      </ul>
    </li>
    <li><a href="#7-setup-mirrorlist-using-reflector">7. Setup Mirrorlist using Reflector</a></li>
    <li><a href="#8-pacstrap-base-packages">8. Pacstrap Base Packages</a></li>
    <li><a href="#9-generate-mount-info-fstab">9. Generate Mount Info Fstab</a></li>
    <li><a href="#10-chroot-into-installed-environment">10. Chroot into Installed Environment</a></li>
    <li><a href="#11-set-timezone">11. Set Timezone</a></li>
    <li><a href="#12-set-locale">12. Set Locale</a></li>
    <li><a href="#13-configure-hostname">13. Configure Hostname</a></li>
    <li><a href="#14-install-additional-packages">14. Install additional packages</a></li>
    <li><a href="#15-unified-kernel-image-setup">15. Unified Kernel Image Setup</a>
      <ul>
        <li><a href="#i-configure-mkinitcpio-hooks">(i) Configure mkinitcpio Hooks</a></li>
        <li><a href="#ii-kernel-parameters">(ii) Kernel Parameters</a></li>
        <li><a href="#iii-crypttab-setup">(iii) Crypttab setup</a></li>
      </ul>
    </li>
    <li><a href="#16-secure-boot-setup">16. Secure boot setup</a>
      <ul>
        <li><a href="#i-install-secure-boot">(i) Install Secure Boot</a></li>
        <li><a href="#ii-create-secure-boot-keys">(ii) Create Secure boot keys</a></li>
        <li><a href="#iii-enroll-keys">(iii) Enroll keys</a></li>
        <li><a href="#iv-sign-bootloader-for-secureboot">(iv) Sign Bootloader for Secureboot</a></li>
      </ul>
    </li>
    <li><a href="#17-bootloader-systemd-boot">17. Bootloader: SystemD Boot</a></li>
    <li><a href="#18-user-management">18. User Management</a></li>
    <li><a href="#19-enable-services">19. Enable services</a></li>
    <li><a href="#20-install-aur-helper">20. Install Aur helper</a></li>
    <li><a href="#21-plymouth-setup">21. Plymouth Setup</a>
      <ul>
        <li><a href="#i-install-plymouth">(i) Install plymouth</a></li>
        <li><a href="#ii-install-plymouth-theme">(ii) Install plymouth theme</a></li>
        <li><a href="#iii-set-plymouth-theme">(iii) Set Plymouth theme</a></li>
        <li><a href="#iv-rerun-mkinitcpio">(iv) Rerun mkinitcpio</a></li>
        <li><a href="#v-regenerate-unified-kernel-image">(v) Regenerate Unified Kernel Image</a></li>
      </ul>
    </li>
    <li><a href="#22-finish-install">22. Finish Install</a></li>
    <li><a href="#23-references">23. References</a></li>
  </ul>
</nav>
              </div>
          </aside>
          

          
          <aside class="tags">
            <h5>Tags</h5>
            <ul class="tags-ul list-unstyled list-inline">
              
              <li class="list-inline-item"><a href="https://aravindim.github.io/tags/arch-linux" target="_blank">Arch Linux</a></li>
              
              <li class="list-inline-item"><a href="https://aravindim.github.io/tags/install" target="_blank">Install</a></li>
              
              <li class="list-inline-item"><a href="https://aravindim.github.io/tags/uefi" target="_blank">UEFI</a></li>
              
              <li class="list-inline-item"><a href="https://aravindim.github.io/tags/systemd-boot" target="_blank">SystemD Boot</a></li>
              
              <li class="list-inline-item"><a href="https://aravindim.github.io/tags/btrfs" target="_blank">BTRFS</a></li>
              
              <li class="list-inline-item"><a href="https://aravindim.github.io/tags/lvm" target="_blank">LVM</a></li>
              
              <li class="list-inline-item"><a href="https://aravindim.github.io/tags/luks" target="_blank">LUKS</a></li>
              
              <li class="list-inline-item"><a href="https://aravindim.github.io/tags/unified-kernel-image-uki" target="_blank">Unified Kernel Image (UKI)</a></li>
              
              <li class="list-inline-item"><a href="https://aravindim.github.io/tags/secure-boot" target="_blank">Secure Boot</a></li>
              
            </ul>
          </aside>
          

          
          <aside class="social">
            <h5>Social</h5>
            <div class="social-content">
              <ul class="list-inline">
                <li class="list-inline-item text-center">
                  <a target="_blank" href="https://twitter.com/share?text=How%20to%20install%20Arch%20Linux%20with%20UEFI%20%2b%20LUKS%20%2b%20LVM%20%2b%20%20BTRFS%20%2b%20Unified%20Kernel%20Image%20%2b%20System%20D%20Boot%20%2b%20Secure%20Boot&url=https%3a%2f%2faravindim.github.io%2fblogs%2fhow-to-install-arch-linux-uefi-luks-lvm-btrfs-systemdboot-uki-secure-boot%2f">
                    <i class="fab fa-twitter"></i>
                  </a>
                </li>
                <li class="list-inline-item text-center">
                  <a target="_blank" href="https://api.whatsapp.com/send?text=How%20to%20install%20Arch%20Linux%20with%20UEFI%20%2b%20LUKS%20%2b%20LVM%20%2b%20%20BTRFS%20%2b%20Unified%20Kernel%20Image%20%2b%20System%20D%20Boot%20%2b%20Secure%20Boot: https%3a%2f%2faravindim.github.io%2fblogs%2fhow-to-install-arch-linux-uefi-luks-lvm-btrfs-systemdboot-uki-secure-boot%2f">
                    <i class="fab fa-whatsapp"></i>
                  </a>
                </li>
                <li class="list-inline-item text-center">
                  <a target="_blank" href='mailto:?subject=How%20to%20install%20Arch%20Linux%20with%20UEFI%20%2b%20LUKS%20%2b%20LVM%20%2b%20%20BTRFS%20%2b%20Unified%20Kernel%20Image%20%2b%20System%20D%20Boot%20%2b%20Secure%20Boot&amp;body=Checkout%20the%20developer%20Aravind%20I%20M%21 https%3a%2f%2faravindim.github.io%2fblogs%2fhow-to-install-arch-linux-uefi-luks-lvm-btrfs-systemdboot-uki-secure-boot%2f'>
                    <i class="fa fa-envelope"></i>
                  </a>
                </li>
              </ul>
            </div>
          </aside>
          
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-12 col-lg-9 p-4">
        
      </div>
    </div>
  </div>
  <button class="p-2 px-3" onclick="topFunction()" id="topScroll">
    <i class="fas fa-angle-up"></i>
  </button>
</section>


<div class="progress">
  <div id="scroll-progress-bar" class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
</div>
<Script src="/js/scrollProgressBar.js"></script>


<script>
  var topScroll = document.getElementById("topScroll");
  window.onscroll = function() {scrollFunction()};

  function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
      topScroll.style.display = "block";
    } else {
      topScroll.style.display = "none";
    }
  }

  function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
  }
</script>


<script src="/js/readingTime.js"></script>



  </div><footer>
    <div class="container py-3" id="recent-posts">
    
    
    
    
    <div class="h3 text-center text-secondary py-3">
        Recent Posts
    </div>
    <div class="row justify-content-center">
        
        <div class="col-lg-4 col-md-6 pt-2">
            <div class="card h-100">
                
                <div class="card-header">
                    <a href="/blogs/how-to-install-arch-linux-uefi-luks-lvm-btrfs-systemdboot-uki-secure-boot/">
                        <img src="/images/post.jpg" class="card-img-top" alt="How to install Arch Linux with UEFI &#43; LUKS &#43; LVM &#43;  BTRFS &#43; Unified Kernel Image &#43; System D Boot &#43; Secure Boot">
                    </a>
                </div>
                
                <div class="card-body bg-transparent p-3 shadow-sm">
                    <a href="/blogs/how-to-install-arch-linux-uefi-luks-lvm-btrfs-systemdboot-uki-secure-boot/" class="primary-font card-title">
                        <h5 class="card-title bg-transparent" title="How to install Arch Linux with UEFI &#43; LUKS &#43; LVM &#43;  BTRFS &#43; Unified Kernel Image &#43; System D Boot &#43; Secure Boot">How to install Arch Linux …</h5>
                    </a>
                    <div class="card-text secondary-font">
                        <p>Installation Steps 1. Connect to Wifi Source: iwctl
# iwctl [iwd]# device list [iwd]# device deviceName set-property Powered on [iwd]# station deviceName scan [iwd]# station deviceName get-networks [iwd]# station deviceName connect SSID # exit (i) Check internet $ ping archlinux.org 2. Check system …</p>
                    </div>
                </div>
                <div class="mt-auto card-footer">
                    <span class="float-start">Aug 11, 2023</span>
                    <a href="/blogs/how-to-install-arch-linux-uefi-luks-lvm-btrfs-systemdboot-uki-secure-boot/" class="float-end btn btn-outline-info btn-sm">Read</a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 pt-2">
            <div class="card h-100">
                
                <div class="card-header">
                    <a href="/blogs/howt-to-make-dnf-faster/">
                        <img src="/images/post.jpg" class="card-img-top" alt="How to make dnf faster in Fedora">
                    </a>
                </div>
                
                <div class="card-body bg-transparent p-3 shadow-sm">
                    <a href="/blogs/howt-to-make-dnf-faster/" class="primary-font card-title">
                        <h5 class="card-title bg-transparent" title="How to make dnf faster in Fedora">How to make dnf faster in …</h5>
                    </a>
                    <div class="card-text secondary-font">
                        <p>Setup the config file To make dnf (Dandified Yum) faster in Fedora, you can edit the [main] section in the file /etc/dnf/dnf.conf try the following optimization tips:
Enable Fastest Mirrors Enable fastest mirrors so that dnf will check all mirrors for the fastest one:
[main] ... fastestmirror=True …</p>
                    </div>
                </div>
                <div class="mt-auto card-footer">
                    <span class="float-start">Nov 3, 2022</span>
                    <a href="/blogs/howt-to-make-dnf-faster/" class="float-end btn btn-outline-info btn-sm">Read</a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 col-md-6 pt-2">
            <div class="card h-100">
                
                <div class="card-header">
                    <a href="/blogs/how-to-setup-nodejs-in-guix/">
                        <img src="/images/post.jpg" class="card-img-top" alt="Setting Up NodeJS in Guix">
                    </a>
                </div>
                
                <div class="card-body bg-transparent p-3 shadow-sm">
                    <a href="/blogs/how-to-setup-nodejs-in-guix/" class="primary-font card-title">
                        <h5 class="card-title bg-transparent" title="Setting Up NodeJS in Guix">Setting Up NodeJS in Guix</h5>
                    </a>
                    <div class="card-text secondary-font">
                        <p>Install node from guix repo Either install it into user&rsquo;s guix profile using the following command:
guix pull guix install node Or install it system-wide by adding the line (specification-&gt;package &ldquo;node&rdquo;) to your system&rsquo;s config file /etc/config.scm as shown below: …</p>
                    </div>
                </div>
                <div class="mt-auto card-footer">
                    <span class="float-start">Nov 3, 2022</span>
                    <a href="/blogs/how-to-setup-nodejs-in-guix/" class="float-end btn btn-outline-info btn-sm">Read</a>
                </div>
            </div>
        </div>
        
    </div>
    
</div><div class="text-center pt-2">
    
    <span class="px-1">
        <a href="https://github.com/AravindIM" aria-label="github">
            <svg xmlns="http://www.w3.org/2000/svg" width="2.7em" height="2.7em" viewBox="0 0 1792 1792">
                <path
                    d="M522 1352q-8 9-20-3-13-11-4-19 8-9 20 3 12 11 4 19zm-42-61q9 12 0 19-8 6-17-7t0-18q9-7 17 6zm-61-60q-5 7-13 2-10-5-7-12 3-5 13-2 10 5 7 12zm31 34q-6 7-16-3-9-11-2-16 6-6 16 3 9 11 2 16zm129 112q-4 12-19 6-17-4-13-15t19-7q16 5 13 16zm63 5q0 11-16 11-17 2-17-11 0-11 16-11 17-2 17 11zm58-10q2 10-14 14t-18-8 14-15q16-2 18 9zm964-956v960q0 119-84.5 203.5t-203.5 84.5h-224q-16 0-24.5-1t-19.5-5-16-14.5-5-27.5v-239q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-86-13.5q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 103t.5 68q0 22-11 33.5t-22 13-33 1.5h-224q-119 0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5 84.5t84.5 203.5z" />

                <metadata>
                    <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                        xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#" xmlns:dc="http://purl.org/dc/elements/1.1/">
                        <rdf:Description about="https://iconscout.com/legal#licenses"
                            dc:title="Github, Online, Project, Hosting, Square"
                            dc:description="Github, Online, Project, Hosting, Square" dc:publisher="Iconscout"
                            dc:date="2016-12-14" dc:format="image/svg+xml" dc:language="en">
                            <dc:creator>
                                <rdf:Bag>
                                    <rdf:li>Font Awesome</rdf:li>
                                </rdf:Bag>
                            </dc:creator>
                        </rdf:Description>
                    </rdf:RDF>
                </metadata>
            </svg>
        </a>
    </span>
    

    
    <span class="px-1">
        <a href="https://linkedin.com/in/aravindim" aria-label="linkedin">
            <svg xmlns="http://www.w3.org/2000/svg" width='2.4em' height='2.4em' fill="#fff" aria-label="LinkedIn"
                viewBox="0 0 512 512">
                <rect width="512" height="512" fill="#0077b5" rx="15%" />
                <circle cx="142" cy="138" r="37" />
                <path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198" />
                <path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32" />
            </svg>
        </a>
    </span>
    

    
    <a href="https://twitter.com/aravind_i_m" aria-label="twitter">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48px" height="48px">
            <path fill="#03a9f4"
                d="M42,37c0,2.762-2.239,5-5,5H11c-2.762,0-5-2.238-5-5V11c0-2.762,2.238-5,5-5h26c2.761,0,5,2.238,5,5 V37z" />
            <path fill="#fff"
                d="M36,17.12c-0.882,0.391-1.999,0.758-3,0.88c1.018-0.604,2.633-1.862,3-3 c-0.951,0.559-2.671,1.156-3.793,1.372C31.311,15.422,30.033,15,28.617,15C25.897,15,24,17.305,24,20v2c-4,0-7.9-3.047-10.327-6 c-0.427,0.721-0.667,1.565-0.667,2.457c0,1.819,1.671,3.665,2.994,4.543c-0.807-0.025-2.335-0.641-3-1c0,0.016,0,0.036,0,0.057 c0,2.367,1.661,3.974,3.912,4.422C16.501,26.592,16,27,14.072,27c0.626,1.935,3.773,2.958,5.928,3c-1.686,1.307-4.692,2-7,2 c-0.399,0-0.615,0.022-1-0.023C14.178,33.357,17.22,34,20,34c9.057,0,14-6.918,14-13.37c0-0.212-0.007-0.922-0.018-1.13 C34.95,18.818,35.342,18.104,36,17.12" />
        </svg>
    </a>
    

    
    <a href="https://instagram.com/aravind.i.m" aria-label="instagram">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48px" height="48px">
            <radialGradient id="yOrnnhliCrdS2gy~4tD8ma" cx="19.38" cy="42.035" r="44.899"
                gradientUnits="userSpaceOnUse">
                <stop offset="0" stop-color="#fd5" />
                <stop offset=".328" stop-color="#ff543f" />
                <stop offset=".348" stop-color="#fc5245" />
                <stop offset=".504" stop-color="#e64771" />
                <stop offset=".643" stop-color="#d53e91" />
                <stop offset=".761" stop-color="#cc39a4" />
                <stop offset=".841" stop-color="#c837ab" />
            </radialGradient>
            <path fill="url(#yOrnnhliCrdS2gy~4tD8ma)"
                d="M34.017,41.99l-20,0.019c-4.4,0.004-8.003-3.592-8.008-7.992l-0.019-20	c-0.004-4.4,3.592-8.003,7.992-8.008l20-0.019c4.4-0.004,8.003,3.592,8.008,7.992l0.019,20	C42.014,38.383,38.417,41.986,34.017,41.99z" />
            <radialGradient id="yOrnnhliCrdS2gy~4tD8mb" cx="11.786" cy="5.54" r="29.813"
                gradientTransform="matrix(1 0 0 .6663 0 1.849)" gradientUnits="userSpaceOnUse">
                <stop offset="0" stop-color="#4168c9" />
                <stop offset=".999" stop-color="#4168c9" stop-opacity="0" />
            </radialGradient>
            <path fill="url(#yOrnnhliCrdS2gy~4tD8mb)"
                d="M34.017,41.99l-20,0.019c-4.4,0.004-8.003-3.592-8.008-7.992l-0.019-20	c-0.004-4.4,3.592-8.003,7.992-8.008l20-0.019c4.4-0.004,8.003,3.592,8.008,7.992l0.019,20	C42.014,38.383,38.417,41.986,34.017,41.99z" />
            <path fill="#fff"
                d="M24,31c-3.859,0-7-3.14-7-7s3.141-7,7-7s7,3.14,7,7S27.859,31,24,31z M24,19c-2.757,0-5,2.243-5,5	s2.243,5,5,5s5-2.243,5-5S26.757,19,24,19z" />
            <circle cx="31.5" cy="16.5" r="1.5" fill="#fff" />
            <path fill="#fff"
                d="M30,37H18c-3.859,0-7-3.14-7-7V18c0-3.86,3.141-7,7-7h12c3.859,0,7,3.14,7,7v12	C37,33.86,33.859,37,30,37z M18,13c-2.757,0-5,2.243-5,5v12c0,2.757,2.243,5,5,5h12c2.757,0,5-2.243,5-5V18c0-2.757-2.243-5-5-5H18z" />
        </svg>
    </a>
    

    
    <a href="https://facebook.com/aravind-i-m" aria-label="facebook">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48px" height="48px">
            <path fill="#3F51B5"
                d="M42,37c0,2.762-2.238,5-5,5H11c-2.761,0-5-2.238-5-5V11c0-2.762,2.239-5,5-5h26c2.762,0,5,2.238,5,5V37z" />
            <path fill="#FFF"
                d="M34.368,25H31v13h-5V25h-3v-4h3v-2.41c0.002-3.508,1.459-5.59,5.592-5.59H35v4h-2.287C31.104,17,31,17.6,31,18.723V21h4L34.368,25z" />
        </svg>
    </a>
    
</div><div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-4 text-center">
            <div class="pb-2">
                <a href="https://aravindim.github.io/" title="Aravind I M">
                    <img alt="Footer logo" src="https://gravatar.com/avatar/1a4f24684715f73e2ae948f646a8db75?s=32"
                        height="40px" width="40px">
                </a>
            </div>
            &copy; 2023  Website made by Aravind I M. Licensed under Apache 2.0. All content provided on the website is licensed under the Creative Commons CC-BY-SA License
            <div class="text-secondary">
                Made with
                <span class="text-danger">
                    &#10084;
                </span>
                and
                <a href="https://github.com/gurusabarish/hugo-profile" target="_blank"
                    title="Designed and developed by gurusabarish">
                    Hugo Profile
                </a>
            </div>
        </div>
    </div>
</div></footer><script src="/bootstrap-5/js/bootstrap.bundle.min.js"></script>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })

</script>


    <script src="/js/search.js"></script>








<script src="/js/contact.js"></script>


<script src="https://js.hcaptcha.com/1/api.js" async defer></script>




  <section id="search-content" class="py-2">
    <div class="container" id="search-results"></div>
  </section>
</body>

</html>